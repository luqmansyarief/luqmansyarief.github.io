<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="description" content="this site is Sirice's blog.">


    <meta name="keywords" content="Sirice, LiuZijian, Blog, CodeBlog">


<title>毕业设计记录日志(BackEnd:SpringBoot+MyBatis+MySQL) | Sirice&#39;s blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Sirice&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Sirice&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div id="post-toc" class="post-toc">
            <span class="post-toc-title">catalogue</span>
            <div class="post-toc-content">
                <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-3-20"><span class="toc-text">2019.3.20</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#注册服务"><span class="toc-text">注册服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#字符集配置"><span class="toc-text">字符集配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-3-24"><span class="toc-text">2019.3.24</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#项目构建"><span class="toc-text">项目构建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#逆向工程"><span class="toc-text">逆向工程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-3-24-Midnight-25"><span class="toc-text">2019.3.24 Midnight - 25</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#java执行条件查询"><span class="toc-text">java执行条件查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-4-10"><span class="toc-text">2019.4.10</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Springboot-热部署"><span class="toc-text">Springboot 热部署</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#页面的存放"><span class="toc-text">页面的存放</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#自动跳转默认页面"><span class="toc-text">自动跳转默认页面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-5-1"><span class="toc-text">2019.5.1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis关联查询"><span class="toc-text">Mybatis关联查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-5-2"><span class="toc-text">2019.5.2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis关联查询后部分字段丢失（null）问题"><span class="toc-text">Mybatis关联查询后部分字段丢失（null）问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis关联查询后外键丢失（null）问题"><span class="toc-text">Mybatis关联查询后外键丢失（null）问题</span></a></li></ol></li></ol>
            </div>
        </div>
    
    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">毕业设计记录日志(BackEnd:SpringBoot+MyBatis+MySQL)</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Sirice</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 20, 2019&nbsp;&nbsp;17:35:56</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/Graduation-Project/">Graduation Project</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <section class="post-content">
            <blockquote>
<p>开个帖记录一下毕业设计流程和踩过的坑。实训时有老师和同学可以一起商议，毕设需要独立解决所有出现的问题。</p>
<p>Enviornment：windows 10 x64，java 1.8，mysql 5.7</p>
</blockquote>
<h4 id="2019-3-20"><a href="#2019-3-20" class="headerlink" title="2019.3.20"></a>2019.3.20</h4><p>环境：mysql community v5.7, windows x64</p>
<p>版本：官网分为两个版本，免安装zip和安装包msi，选择msi版本，安装包上的x86指的是安装器本身是32位文件。</p>
<h5 id="注册服务"><a href="#注册服务" class="headerlink" title="注册服务"></a>注册服务</h5><p>启动和停止mysql服务命令行：</p>
<pre><code>cmd：net start mysql
cmd：net stop mysql
// 注：实际我的电脑中有两个服务：MySQL和MySQL57,第一个服务启动不起来，但第二个是正常的。
// 即我实际执行的是：
cmd：net start mysql57
cmd：net stop mysql57</code></pre><p><em>报错提示：服务名无效 请键入NET HELPING 2185以获得更多的帮助</em></p>
<p>问题原因：mysql没有在windows中添加服务。<br>在MYSQL安装目录bin文件夹中运行命令<code>mysqld --install</code>返回信息<code>Service successfully installed</code>注册成功。</p>
<h5 id="字符集配置"><a href="#字符集配置" class="headerlink" title="字符集配置"></a>字符集配置</h5><blockquote>
<p>默认 latin1 为二进制数据，此项不修改的话在java中提出查询结果为char[]再转换为String.decode()，会产生很多问题。</p>
</blockquote>
<p>修改C:\ProgramData\MySQL\MySQL Server 5.7\my.ini文件中的character字段,具体可参考</p>
<pre><code>[mysqld]
character-set-server=utf8

[client]
default-character-set = utf8</code></pre><p>然后重启服务，在sql Command Line中输入</p>
<pre><code>mysql&gt; show variables like &apos;character%&apos;;</code></pre><p>log信息为</p>
<pre><code>+--------------------------+-------------------------------------------------+
| Variable_name            | Value                                           |
+--------------------------+-------------------------------------------------+
| character_set_client     | utf8                                            |
| character_set_connection | utf8                                            |
| character_set_database   | utf8                                            |
| character_set_filesystem | binary                                          |
| character_set_results    | utf8                                            |
| character_set_server     | utf8                                            |
| character_set_system     | utf8                                            |
| character_sets_dir       | E:\0Develop\mysql-5.7.15-winx64\share\charsets\ |
+--------------------------+-------------------------------------------------+
8 rows in set, 1 warning (0.00 sec)</code></pre><p>则修改成功。</p>
<h4 id="2019-3-24"><a href="#2019-3-24" class="headerlink" title="2019.3.24"></a>2019.3.24</h4><h5 id="项目构建"><a href="#项目构建" class="headerlink" title="项目构建"></a>项目构建</h5><p>idea是一个非常完善和强大的IDE，可以直接使用集成的工具。</p>
<p>首先创建project</p>
<p><img src="https://i.loli.net/2019/03/26/5c99e8eb8f1de.png" alt="第1步"></p>
<p><img src="https://i.loli.net/2019/03/26/5c99e8b511657.jpg" alt="项目名等相关信息"></p>
<p><img src="https://i.loli.net/2019/03/26/5c99e8eb8495a.png" alt="第2步"></p>
<p>点击finish</p>
<p><img src="https://i.loli.net/2019/03/26/5c99e8ebb7cef.png" alt="完成"></p>
<p>项目初始化之后IDE会自动下载所需的jar包和依赖等，构建完成之后，Springboot+MyBatis+MySql(集成jdbc驱动)项目就准备好了。</p>
<p>此处参考链接：</p>
<p><a href="https://blog.csdn.net/guobinhui/article/details/79289189" target="_blank" rel="noopener">最全面的springBoot集成mybatis+mysql项目搭建经验分享 - 奋斗的青春最美 - CSDN博客</a></p>
<p>然后在Springboot这个项目中<strong>配置数据库连接</strong>：</p>
<p>本案例不使用application.properties文件 而使用更加简洁的application.yml文件。将resource文件夹下原有的application.properties文件删除，创建application.yml配置文件</p>
<p><strong>注意这个部分（配置文件）后面有更改</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src\main\resources\application.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    datasource:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">psytest</span></span><br><span class="line"><span class="attr">        url:</span> <span class="attr">jdbc:mysql://localhost:3306/psytest?serverTimezone=GMT%2B8&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="attr">        username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="attr">  mapper-locations:</span> <span class="attr">classpath:mapping/*Mapper.xml</span></span><br><span class="line"><span class="attr">  type-aliases-package:</span> <span class="string">com.psytest.myproject</span></span><br></pre></td></tr></table></figure>

<p>注意此处的jdbc连接参数：<code>serverTimezone=GMT%2B8</code>参数是用来配置数据库时区的，否则立即报错timezone error。<u>除了这里，在下文中说到的MyBatis generator的配置文件generatorConfig.xml(src\main\resources\generator\generatorConfig.xml)中也有一句，这个也是必须写和springboot主配置文件中的数据库连接参数一样的语句。</u></p>
<h5 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h5><p>现在数据库已经有了，项目初始化好了，就需要我们去写页面逻辑。这部分的逻辑是：将数据库表单中一个一个对象抽象映射到java中去，所以在项目中的pojo/entity/bean中会有和数据库中完全一致的对象。</p>
<p>既然数据库已经有了，所以能不能自动将数据库中的对象映射到java中去呢？答案是可以的，使用MyBatis generator插件，可以从数据库直接自动化生成java相关代码。</p>
<p>在初始项目中首先添加依赖插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># ..\pom.xml(在项目根目录)</span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configurationFile</span>&gt;</span>$&#123;basedir&#125;/src/main/resources/generator/generatorConfig.xml<span class="tag">&lt;/<span class="name">configurationFile</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时ide会提醒导入依赖（插件），添加依赖之后，然后在resource文件夹内新建文件夹generator，新建文件generatorConfig.xml，注意这个文件有模板，但需要<strong>自行修改</strong>：
1. 数据库连接参数<br>2. jdbc-mysql驱动jar包路径，这个在IDE左侧的External Libraries中有，直接复制路径就行<br>3. 3个地方改路径（包名和位置）注释中：<br>    1. 生成(实体)模型的包名和位置<br>    2. 生成XML映射文件的包名和位置<br>    3. 生成XML映射文件的包名和位置</p>
<pre><code>具体已经在下面配置好了，供参考。</code></pre><ol start="4">
<li><p>注意</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span> <span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost:3306/psytest?serverTimezone=GMT%2B8"</span> <span class="attr">userId</span>=<span class="string">"root"</span> <span class="attr">password</span>=<span class="string">"root"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useInformationSchema"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置可以获取remarks信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"remarks"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个位置，中间的useInformationSchema属性为Mybatis识别主键的属性，没有这个东西后面生成的方法会少一些根据主键进行的操作。</p>
</li>
</ol>
<p>Sample Code</p>
<p>Path：\src\main\resources\generator\generatorConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE generatorConfiguration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库驱动:选择你的本地硬盘上面的数据库驱动包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span>  <span class="attr">location</span>=<span class="string">"C:\Users\Sirice\.m2\repository\mysql\mysql-connector-java\8.0.15\mysql-connector-java-8.0.15.jar"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"DB2Tables"</span>  <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressDate"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressAllComments"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库连接驱动类,URL，用户名、密码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span> <span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost:3306/psytest?serverTimezone=GMT%2B8"</span> <span class="attr">userId</span>=<span class="string">"root"</span> <span class="attr">password</span>=<span class="string">"root"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useInformationSchema"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--设置可以获取remarks信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"remarks"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 生成(实体)模型的包名和位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.psytest.myproject.bean"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 生成XML映射文件的包名和位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"resources.mapping"</span> <span class="attr">targetProject</span>=<span class="string">"src/main"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 生成DAO接口的包名和位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span> <span class="attr">targetPackage</span>=<span class="string">"com.psytest.myproject.dao"</span> <span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 要生成的表 tableName是数据库中的表名或视图名 domainObjectName是实体类名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"admin"</span> <span class="attr">schema</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在右侧Maven Projects中可以看到plugins/mybatis generator，右键run一下就可以逆向生成了。如果没成功可能是mysql服务没开启或数据库连接有问题。</p>
<p><img src="https://i.loli.net/2019/03/26/5c99e97a6bba1.jpg" alt></p>
<p>这是我生成之后的代码</p>
<p>然后添加业务逻辑：此处示例对admin表根据主键进行查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  AdminService类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.psytest.myproject.service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.psytest.myproject.bean.Admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdminService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">getAdminById</span><span class="params">(<span class="keyword">int</span> adminId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  AdminServiceImpl类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.psytest.myproject.service.serviceImpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.psytest.myproject.bean.Admin;</span><br><span class="line"><span class="keyword">import</span> com.psytest.myproject.dao.AdminMapper;</span><br><span class="line"><span class="keyword">import</span> com.psytest.myproject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"adminService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminServiceImpl</span> <span class="keyword">implements</span> <span class="title">AdminService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AdminMapper admindao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">getAdminById</span><span class="params">(<span class="keyword">int</span> adminId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> admindao.selectByPrimaryKey(adminId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  AdminController类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.psytest.myproject.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.psytest.myproject.bean.Admin;</span><br><span class="line"><span class="keyword">import</span> com.psytest.myproject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/admin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AdminService adminService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/showAdmin"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">toIndex</span><span class="params">(HttpServletRequest request,Model model)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> adminId = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line">        Admin admin = <span class="keyword">this</span>.adminService.getAdminById(adminId);</span><br><span class="line">        <span class="keyword">return</span> admin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>入口类添加注解：（别忘了这个）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  PsytestApplication类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.psytest.myproject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.psytest.myproject.dao"</span>)</span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.psytest.myproject.*"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PsytestApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(PsytestApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时运行程序，通过访问浏览器<code>localhost:8080/admin/showAdmin?id=1</code>可以得到json形式返回值。</p>
<h4 id="2019-3-24-Midnight-25"><a href="#2019-3-24-Midnight-25" class="headerlink" title="2019.3.24 Midnight - 25"></a>2019.3.24 Midnight - 25</h4><h5 id="java执行条件查询"><a href="#java执行条件查询" class="headerlink" title="java执行条件查询"></a>java执行条件查询</h5><p>一直有个问题就是不知道怎么通过generator生成的Mapper文件去搞selectAll方法，实际是我多虑了。Mapper中的SQL语句是结构化语句，也就是说只要不写查询条件就可以为空，即<code>select * from table.</code>。</p>
<p>具体是Mapper中的selectByExample()方法。<br>mapper文件中默认是两个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Admin&gt; <span class="title">selectByExample</span><span class="params">(AdminExample example)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Admin <span class="title">selectByPrimaryKey</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>第二个是根据主键选择一个对象，而第一个就是结构化语句。</p>
<p>原理：它的执行规则是先定义一个AdminExample实例，然后给example添加各种属性。example可以通过其方法createCriteria()创建内部类Criteria，这个内部类有模糊查询等方法可以动态操作映射的sql语句。</p>
<p>当然啥也不写属性全是空，默认为selectAll。</p>
<p>此处为ServiceImpl语句的一个简短实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径：src\main\java\com\psytest\myproject\service\AdminService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdminService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Admin&gt; <span class="title">selectByExample</span><span class="params">(AdminExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径：src\main\java\com\psytest\myproject\service\serviceImpl\AdminServiceImpl.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"adminService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminServiceImpl</span> <span class="keyword">implements</span> <span class="title">AdminService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> List&lt;Admin&gt; <span class="title">selectByExample</span><span class="params">(AdminExample example)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//        example = new AdminExample();</span></span><br><span class="line">  <span class="comment">//        AdminExample.Criteria adminCriteria = example.createCriteria();// Criteria是当前AdminExample的静态内部类</span></span><br><span class="line">  <span class="comment">//        adminCriteria.andUsernameLike("%o%");//后面能有很多方法可以进行模糊查询、拼接查询等</span></span><br><span class="line">  <span class="comment">//        List&lt;Admin&gt; adminList = admindao.selectByExample(example);</span></span><br><span class="line"></span><br><span class="line">         List&lt;Admin&gt; list = admindao.selectByExample(example);</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由这个例子出发，基本增删改查就都可以仿写了。另外注意获取http请求参数是在Controller中完成的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径：src\main\java\com\psytest\myproject\controller\AdminController.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/admin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AdminService adminService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/listall"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Admin&gt; <span class="title">selectByExample</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        AdminExample example = <span class="keyword">new</span> AdminExample();</span><br><span class="line">        List&lt;Admin&gt; list = adminService.selectByExample(example);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service方法中的example对象就是在这里创建并传递的。</p>
<blockquote>
<p>小结：上述每3个类组成一套方法</p>
<ul>
<li>Service类中声明一个和Mapper一致的接口</li>
<li>ServiceImpl类实现该接口</li>
<li>Controller类映射Request和包装一个example对象传递给Service。</li>
</ul>
<p>即上述3个类构成selectAll功能（实际函数还是selectByExample）。</p>
</blockquote>
<p>此时运行Application，进行localhost:8080/admin/listall即可获取所有admin数据。</p>
<h4 id="2019-4-10"><a href="#2019-4-10" class="headerlink" title="2019.4.10"></a>2019.4.10</h4><h5 id="Springboot-热部署"><a href="#Springboot-热部署" class="headerlink" title="Springboot 热部署"></a>Springboot 热部署</h5><p>每次更改了java代码需要重新启动tomcat服务器（重新编译部署）今天了解到springboot自带一个热部署服务，开启这个服务之后修改源码不需要重启服务器即可自动配置。</p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置springboot:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># \src\main\resources\application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    datasource:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">psytest</span></span><br><span class="line"><span class="attr">        url:</span> <span class="attr">jdbc:mysql://localhost:3306/psytest?serverTimezone=GMT%2B8&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="attr">        username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">    thymeleaf:</span></span><br><span class="line"><span class="attr">      cache:</span> <span class="literal">true</span> <span class="comment"># 缓存</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    devtools:</span></span><br><span class="line"><span class="attr">      restart:</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span>  <span class="comment"># 热部署开启</span></span><br><span class="line"><span class="attr">        additional-paths:</span> <span class="string">src/main/java</span> <span class="comment"># 监听目录</span></span><br></pre></td></tr></table></figure>

<p>新增两个字段，thymeleaf和devtools。这个是yml的语法，如果使用的是springboot默认配置application.properties，语法是这样：</p>
<pre><code>spring.thymeleaf.cache=ture
spring.devtools.restart.enabled=true
spring.devtools.restart.additional-paths=src/main/java</code></pre><p>（另外注明，idea会将properties文件语法自动转换为yml语法）</p>
<h5 id="页面的存放"><a href="#页面的存放" class="headerlink" title="页面的存放"></a>页面的存放</h5><p>html静态资源放在<code>\src\main\resources\static</code>中，根据地址<code>localhost:8080/index.html</code>访问。</p>
<h5 id="自动跳转默认页面"><a href="#自动跳转默认页面" class="headerlink" title="自动跳转默认页面"></a>自动跳转默认页面</h5><p>目前的配置需要手动输入index.html后缀，所以需要配置自动跳转，即输入地址<code>localhost:8080</code>就自动跳转html</p>
<p>新建默认Controller跳转至目标页面url，其实就是映射到入口视图上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"/index.html"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2019-5-1"><a href="#2019-5-1" class="headerlink" title="2019.5.1"></a>2019.5.1</h4><h5 id="Mybatis关联查询"><a href="#Mybatis关联查询" class="headerlink" title="Mybatis关联查询"></a>Mybatis关联查询</h5><p>可视化组件需要每个问卷结果表的用户人员信息，也就是说每条记录的json要包含该问卷全部信息+答题人的身份信息。</p>
<p>这就产生了两个思路:<br>1. 前端发请求来做信息拼接？<em>（这个思路出于数据库原理学的不熟练，不想动后端）</em><br>2. 后端进行关联查询？</p>
<p>方式一的特点：不需要更改后端，但前端对于每个数据都要进行一次请求，使用每条问卷的userid属性去做User类的查询。时间复杂度O(n),300数据量的本地查询时间大约为5s，性能实在太低。</p>
<p>另外对于前端需要等待Promise对象完成resolve方法，也就是说将异步的请求当成了同步来做，这个效率大大降低而且违背了Promise对象的设计初衷。</p>
<p>因此方式一是根本达不到要求的。采用方式二：后端进行关联查询。</p>
<p><strong>《阿里java编程规范》中规定：任何时候不允许使用外键设计数据库</strong>：原因就是每次增加、删除时会检索外键的表中的记录是否存在，增大了耦合度且在高并发下会产生死锁。</p>
<p>我采用的是Mybatis框架，支持在不建立外键、不修改数据库的情况下进行关联查询，即修改ORM层的命令，让ORM以特定方式去访问数据库。</p>
<p>这里出现了两个方向：1是在xml中添加查询规则，2是在Mapper.java中以注解形式进行操作。</p>
<p>xml为我们生成的单表控制文件，修改的话可能会出现各种各样不可预知的错误，而java文件灵活性和语义化更好，所以采用java中注解式编程的方法。</p>
<p>下面以DASS21关联User（左连接）方式举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\main\java\com\psytest\myproject\dao\Dass21Mapper.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Dass21Mapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(Dass21 record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Dass21&gt; <span class="title">selectByExample</span><span class="params">(Dass21Example example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Dass21 <span class="title">selectByPrimaryKey</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByExampleSelective</span><span class="params">(@Param(<span class="string">"record"</span>)</span> Dass21 record, @<span class="title">Param</span><span class="params">(<span class="string">"example"</span>)</span> Dass21Example example)</span>;</span><br><span class="line">    <span class="comment">// 已经生成的Mapper方法不在这里重复。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面这个是新添加的</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT * FROM dass21"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(&#123;<span class="meta">@Result</span>(property = <span class="string">"user"</span>,column = <span class="string">"userid"</span>,one = <span class="meta">@One</span>(select=<span class="string">"com.psytest.myproject.dao.UserMapper.selectByPrimaryKey"</span>))&#125;)</span><br><span class="line">    <span class="function">List&lt;Dass21&gt; <span class="title">getRecordWithUserinfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释：</p>
<p><code>@Select(&quot;SELECT * FROM dass21&quot;)</code>方法为查询注解</p>
<p><code>@Results({@Result(property = &quot;user&quot;,column = &quot;userid&quot;,one = @One(select=&quot;com.psytest.myproject.dao.UserMapper.selectByPrimaryKey&quot;))})</code>为结果集的扩充，property为扩充字段（关联表），column为扩充字段主键（关联表的主键），one的@One注解为一对一查询命令，关联调用的查询方法。</p>
<p>这样dao层相当于新加了一个方法，Service、ServiceImpl、Controller再次实现一下就好</p>
<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// com/psytest/myproject/service/Dass21Service.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Dass21Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Dass21&gt; <span class="title">getRecordWithUserinfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// com/psytest/myproject/service/serviceImpl/Dass21ServiceImpl.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"dass21Service"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dass21ServiceImpl</span> <span class="keyword">implements</span> <span class="title">Dass21Service</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Dass21Mapper Dass21dao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dass21&gt; <span class="title">getRecordWithUserinfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Dass21dao.getRecordWithUserinfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// com/psytest/myproject/controller/Dass21Controller.java</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/dass21"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dass21Controller</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Dass21Service dass21Service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/history_list_detail"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function">List&lt;Dass21&gt; <span class="title">getRecordWithUserinfo</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dass21Service.getRecordWithUserinfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到这里没完事，因为返回值是一个POJO对象，也就是bean对象，关联表中的user部分没有被映射过来，所以需要在dass21 bean中添加与User的组合。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dass21</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> User user; <span class="comment">// 组合</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter setter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到此，Mybatis的关联查询就完成了，这是一对一的关联，一对多的关联在@Results中再次添加@Result注解即可对2个以上的表进行关联。</p>
<p>但这样仍存在问题：bean中为了一个功能增加了一个字段，在其他方法中都含有user:null无效信息。我的思考是这部分似乎可以用Builder模式解决，后续有时间再重构吧，毕竟毕业时间卡的紧。。。</p>
<h4 id="2019-5-2"><a href="#2019-5-2" class="headerlink" title="2019.5.2"></a>2019.5.2</h4><h5 id="Mybatis关联查询后部分字段丢失（null）问题"><a href="#Mybatis关联查询后部分字段丢失（null）问题" class="headerlink" title="Mybatis关联查询后部分字段丢失（null）问题"></a>Mybatis关联查询后部分字段丢失（null）问题</h5><p>发现了一个问题，关联查询之后有部分原来正常的字段变为null。查了一下大概是两种可能</p>
<ol>
<li>mapper.xml中用resultMap映射但是关联表却使用了resultType映射，造成对象映射时字段数据格式不统一</li>
<li>mysql变量大小写敏感，但mybatis映射自动忽略（且为默认配置）</li>
</ol>
<p>看了下mapper.xml，因为使用了generator插件生成，正常不会产生第一种问题，因此应该是第二个。因此在配置文件中加入configuration，更改后的文件为：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src\main\resources\application.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    datasource:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">psytest</span></span><br><span class="line"><span class="attr">        url:</span> <span class="attr">jdbc:mysql://localhost:3306/psytest?serverTimezone=GMT%2B8&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="attr">        username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">        driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">    thymeleaf:</span></span><br><span class="line"><span class="attr">      cache:</span> <span class="literal">true</span> <span class="comment"># 缓存</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    devtools:</span></span><br><span class="line"><span class="attr">      restart:</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span>  <span class="comment"># 热部署开启</span></span><br><span class="line"><span class="attr">        additional-paths:</span> <span class="string">src/main/java</span> <span class="comment"># 监听目录</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="attr">  mapper-locations:</span> <span class="attr">classpath:mapping/*Mapper.xml</span></span><br><span class="line"><span class="attr">  type-aliases-package:</span> <span class="string">com.psytest.myproject</span></span><br><span class="line">  <span class="comment"># 开启驼峰映射</span></span><br><span class="line"><span class="attr">  configuration:</span></span><br><span class="line"><span class="attr">    map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>参考链接：<a href="https://blog.csdn.net/zdyueguanyun/article/details/77977890" target="_blank" rel="noopener">mybatis查询出来的字段的值为null,驼峰字段 - yueguanyun的专栏 - CSDN博客</a></p>
<h5 id="Mybatis关联查询后外键丢失（null）问题"><a href="#Mybatis关联查询后外键丢失（null）问题" class="headerlink" title="Mybatis关联查询后外键丢失（null）问题"></a>Mybatis关联查询后外键丢失（null）问题</h5><p>这个问题和上面那个不太一样，上面那个通过设置大小写敏感解决了，但外键丢失不是由于大小写问题产生的。</p>
<p>问题描述：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 不含关联查询的json结果，userid可以正常获取</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">	<span class="attr">"userid"</span>: <span class="number">361</span>,</span><br><span class="line">	<span class="attr">"time"</span>: <span class="string">"2019-04-15T13:48:13.000+0000"</span>,</span><br><span class="line">	<span class="attr">"answer1"</span>: <span class="number">3</span>,</span><br><span class="line">  /* （省略部分字段） */</span><br><span class="line">	"user": null // Object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 开启关联查询的json结果，userid为null</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">	<span class="attr">"userid"</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">"time"</span>: <span class="string">"2019-04-15T13:48:13.000+0000"</span>,</span><br><span class="line">	<span class="attr">"answer1"</span>: <span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">	<span class="attr">"psychoticism"</span>: <span class="number">30</span>,</span><br><span class="line">	<span class="attr">"user"</span>: &#123;</span><br><span class="line">		<span class="attr">"id"</span>: <span class="number">361</span>,</span><br><span class="line">		<span class="attr">"username"</span>: <span class="string">"Shirley Rodriguez"</span>,</span><br><span class="line">		<span class="attr">"password"</span>: <span class="string">"abc123"</span>,</span><br><span class="line">		<span class="attr">"authority"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="attr">"age"</span>: <span class="number">52</span>,</span><br><span class="line">		<span class="attr">"sex"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="attr">"work"</span>: <span class="string">"D"</span>,</span><br><span class="line">		<span class="attr">"location"</span>: <span class="string">"浙江省 温州市"</span>,</span><br><span class="line">		<span class="attr">"salary"</span>: <span class="number">3</span>,</span><br><span class="line">		<span class="attr">"marriage"</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>具体问题就是<strong>开启关联查询之后外键变为null</strong>。这个问题推测是由于userid与user中的id被映射为相同值，也就是说有了两个Key。。</p>
<p>解决办法是在dao层的Mapper.java中<code>@Select</code>注解中避免使用<code>select * from table</code>的通配符，而使用该变量的别名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> userid <span class="keyword">as</span> user_id,[other arguments] <span class="keyword">from</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<p>这样可以避免同字段冲突。</p>

        </section>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Sirice</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://sirice19.github.io/2019/03/20/graduateDesignRecord-BackEnd/">https://sirice19.github.io/2019/03/20/graduateDesignRecord-BackEnd/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>本文采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享 署名-非商业性使用-禁止演绎(CC BY-NC-ND)国际许可协议</a>进行许可</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/java/"># java</a>
                    
                        <a href="/tag/SpringBoot/"># SpringBoot</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/03/26/web-api-note/">Web API设计简要笔记</a>
            
            
            <a class="next" rel="next" href="/2019/03/13/thinkings-19Mar13/">混乱的三月</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Sirice | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Sirice19/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
    </div>
</body>
</html>